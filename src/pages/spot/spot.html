<ion-header>
  <ion-toolbar color="blue" no-border-top>
      <button  ion-button icon-only menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
      <ion-title>{{ 'TITLE.SPOTS' | translate }}</ion-title>
      <ion-buttons end>
        <button  ion-button icon-only (click)="goFiltreSpot()">
          <ion-icon name="ios-search"></ion-icon>
        </button>
      </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content class="bacground-light">

    <div *ngIf="userUid; then authenticated else guest">  </div>

    <ion-refresher (ionRefresh)="doRefresh($event)">
        <ion-refresher-content
            pullingText="Pull to refresh..."
            refreshingText="Refreshing...">
          </ion-refresher-content>
    </ion-refresher>

    <ng-template #guest>
        <ion-row class="warning-container">
            <ion-col col-12>
                {{ 'WARNING.NOT_CONNECTED_SPOT' | translate }}
            </ion-col>
        </ion-row>
    </ng-template>

    <ng-template #authenticated>
       
        <my-loader *ngIf="searchSpots"></my-loader>
        
        <ion-row *ngIf="(spots)?.length==0 && (searchSpots) == false" class="warning-container">
            <ion-col col-12>
                {{ 'WARNING.EMPTY_SPOT' | translate }}
            </ion-col>
        </ion-row>
    
        <ion-list> 
    
            <ion-card *ngFor="let spot of spots | async">
                
                  <ion-item (tap)="goDetailSpot(spot)">
                    <ion-avatar *ngIf="!spot.anonyme" item-start>
                        <img [src]="(spot.userPicture)" />
                    </ion-avatar>
                    <ion-avatar *ngIf="spot.anonyme" item-start>
                        <ion-icon class="icon-size" name="contact"></ion-icon>
                    </ion-avatar>

                    <h3 *ngIf="!spot.anonyme">{{ spot.userName }}</h3>
                    <h3 *ngIf="spot.anonyme">{{ 'ANONYME' | translate }}</h3>
                    <p>{{spot.dateUpdate | formatDate}}</p>  
                  </ion-item>
            
                
                  <ion-card-content (tap)="goDetailSpot(spot)">
                    <p class="paragraphe-height" [innerHTML]="spot.message  | formatHashtag"></p>
                  </ion-card-content>
                
                  <ion-row class="padding-left">
                    <ion-col>
                      <button class="button-padding" (click)="incrementLike(spot)" ion-button icon-left clear small>
                        <ion-icon [name]="spot.likes | formatLikeIcon:userUid"></ion-icon>
                    </button> 
                    <button class="button-padding" (click)="openModalLike(spot)" ion-button icon-left clear small>
                        <div>{{spot.likes | formatLikes}}  Likes</div>
                    </button>
                    </ion-col>
                    <ion-col> 
                        <ion-item>
                            <button (click)="openModalLike(spot)"  ion-button item-end icon-left clear small>
                                <ion-icon name="text"></ion-icon>
                                <div>4 Comments</div>
                            </button>
                        </ion-item> 
                    </ion-col>
                  </ion-row>
                
                </ion-card>
    
        </ion-list>
    
        <ion-infinite-scroll (ionInfinite)="doInfinite($event)" threshold="100px">
            <ion-infinite-scroll-content
              loadingSpinner="bubbles"
              loadingText="Loading more data...">
            </ion-infinite-scroll-content>
        </ion-infinite-scroll>
    

    </ng-template>

    <ion-fab *ngIf="auth.user | async" right bottom>
        <button color="blue" ion-fab (click)="goAddSpot()"><ion-icon name="add"></ion-icon></button>
    </ion-fab>
      

</ion-content>
